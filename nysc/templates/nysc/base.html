{% load static %}
{% load form_tags %}

<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Corps Connect{% endblock %}</title> 
    <meta name="description" content="Corps Connect helps you find and review Primary Place of Assignment (PPA) opportunities in Nigeria. Submit, rate, and connect with others!">
    <meta name="keywords" content="Corps, NYSC, PPA, Nigeria, job placement, reviews, connect, place of primary assignment, ppa, camp">
    <meta name="robots" content="index, follow">
    <meta name="twitter:site" content="@corpsconnectt">
    <meta name="twitter:creator" content="@corpsconnectt">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="{% static 'nysc/css/styles.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link href="{% static 'nysc/css/custom.css' %}" rel="stylesheet">
    <link rel="manifest" href="{% static 'nysc/json/manifest.json' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'nysc/favicon/favicon.ico' %}">
</head>
<body>
    
    <!-- Notification Banner -->
    <div id="notificationBanner" class="notification-banner" style="display: none;"></div>

    <!-- Custom Modal -->
    <div id="customModal" class="custom-modal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h5 id="customModalTitle"></h5>
                <button class="custom-modal-close" id="customModalClose">Ã—</button>
            </div>
            <div class="custom-modal-body" id="customModalBody">
                <!-- Content will be injected via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Collapsible Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            {% if user.is_authenticated %}
                <a href="#" id="profileHeader" class="profile-header" data-bs-toggle="dropdown" aria-expanded="false">
                    {% if user.profile.profile_picture %}
                        <img src="{{ user.profile.profile_picture.url }}" alt="Profile" class="profile-pic-icon">
                    {% else %}
                        <span class="default-profile-pic">{{ user.username|first|upper }}</span>
                    {% endif %}
                    <span class="user-name">{{ user.username }}</span>
                </a>
                <!-- Followers/Following Section -->
                <div class="follow-stats">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <span class="stat-value">{{ user.followers.count }}</span>
                        <span class="stat-label">Followers</span>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-user-plus"></i>
                        <span class="stat-value">{{ user.following.count }}</span>
                        <span class="stat-label">Following</span>
                    </div>
                </div>
                <ul class="dropdown-menu dropdown-menu-end profile-dropdown">
                    <li><a class="dropdown-item" href="{% url 'profile_view' user.username %}">View Profile</a></li>
                    <li><a class="dropdown-item" href="{% url 'profile_edit' %}">Edit Profile</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <form action="{% url 'logout' %}" method="post" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="dropdown-item">Logout</button>
                        </form>
                    </li>
                </ul>
            {% else %}
                <a href="{% url 'login' %}" class="sidebar-brand">Corps Connect</a>
            {% endif %}
        </div>
        <ul class="sidebar-menu">
            <li class="menu-item {% if request.path == '/' %}active{% endif %}">
                <a href="{% url 'ppa_finder' %}">
                    <i class="fas fa-search"></i><span class="menu-text">PPA Finder</span>
                </a>
            </li>
            <li class="menu-item {% if request.path == '/submit-ppa/' %}active{% endif %}">
                <a href="{% url 'submit_ppa' %}">
                    <i class="fas fa-plus"></i><span class="menu-text">Submit PPA</span>
                </a>
            </li>
            <li class="menu-item {% if request.path == '/leaderboard/' %}active{% endif %}">
                <a href="{% url 'leaderboard' %}">
                    <i class="fas fa-trophy"></i><span class="menu-text">Leaderboard</span>
                </a>
            </li>
            <li class="menu-item {% if request.path == '/marketplace/' %}active{% endif %}">
                <a href="{% url 'marketplace_coming_soon' %}">
                    <i class="fas fa-store"></i><span class="menu-text">Marketplace</span>
                </a>
            </li>
            <li class="menu-item {% if request.path == '/camp-info/' %}active{% endif %}">
                <a href="{% url 'camp_info' %}">
                    <i class="fas fa-campground"></i><span class="menu-text">Camp Information</span>
                </a>
            </li>
            {% if user.is_authenticated %}
                <li class="menu-item">
                    <a href="#" id="addToHomescreenBtn">
                        <i class="fas fa-plus-square"></i><span class="menu-text">Add to Homescreen</span>
                    </a>
                </li>
            {% else %}
                <li class="menu-item {% if request.path == '/login/' %}active{% endif %}">
                    <a href="{% url 'login' %}">
                        <i class="fas fa-sign-in-alt"></i><span class="menu-text">Login</span>
                    </a>
                </li>
                <li class="menu-item {% if request.path == '/register/' %}active{% endif %}">
                    <a href="{% url 'register' %}">
                        <i class="fas fa-user-plus"></i><span class="menu-text">Register</span>
                    </a>
                </li>
            {% endif %}
            <li class="menu-item">
                <button class="btn btn-link nav-link theme-toggle w-100 text-start" title="Toggle Light Mode">
                    <i class="fas fa-sun"></i><span class="menu-text">Theme</span>
                </button>
            </li>
            <li class="menu-item social-media">
                <a href="https://twitter.com/corpsconnectt" target="_blank" title="Follow us on Twitter">
                    <i class="fab fa-twitter"></i><span class="menu-text">Follow us</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- Overlay to close sidebar on outside click -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Desktop Toggle Button (only for authenticated users) -->
        {% if user.is_authenticated %}
            <button id="sidebarToggleDesktop" class="btn btn-primary d-none d-lg-block" style="position: fixed; top: 10px; left: 10px; z-index: 1100; padding: 0; border: none; background: none;">
                {% if user.profile.profile_picture %}
                    <img src="{{ user.profile.profile_picture.url }}" alt="Profile" class="profile-pic-icon" style="width: 40px; height: 40px; border-radius: 50%;">
                {% else %}
                    <span class="default-profile-pic" style="width: 40px; height: 40px; line-height: 40px;">{{ user.username|first|upper }}</span>
                {% endif %}
            </button>
        {% endif %}

        <!-- Mobile Header -->
        <header class="mobile-header d-lg-none">
            <button class="sidebar-toggle-mobile" id="sidebarToggleMobile">
                {% if user.is_authenticated and user.profile.profile_picture %}
                    <img src="{{ user.profile.profile_picture.url }}" alt="Profile" class="profile-pic-icon-mobile">
                {% elif user.is_authenticated %}
                    <span class="default-profile-pic-mobile">{{ user.username|first|upper }}</span>
                {% else %}
                    <!-- Placeholder or alternative for unauthenticated users -->
                    <i class="fas fa-bars" style="font-size: 1.5rem;"></i>
                {% endif %}
            </button>
            <div class="mobile-brand-container">
                <img src="{% static 'nysc/images/icon(1).png' %}" alt="Corps Connect Logo" class="mobile-logo">
                <a href="{% url 'ppa_finder' %}" class="mobile-brand">
                    Corps Connect
                </a>
            </div>
        </header>

        <!-- Quick Access Bar -->
        <div class="quick-access-bar position-fixed w-100 bg-dark bg-opacity-75 p-2 d-flex justify-content-around align-items-center" style="bottom: 0; z-index: 1000; box-shadow: 0 -2px 10px rgba(0,0,0,0.2);">
            <a href="{% url 'ppa_finder' %}" class="quick-access-btn text-white">
                <i class="fas fa-search fs-4"></i>
            </a>
            <a href="{% url 'leaderboard' %}" class="quick-access-btn text-white">
                <i class="fas fa-trophy fs-4"></i>
            </a>
            {% if user.is_authenticated %}
                <a href="{% url 'notifications' %}" id="notificationQuickAccess" class="quick-access-btn text-white position-relative">
                    <i class="fas fa-bell fs-4"></i>
                    {% if unread_notification_count > 0 %}
                        <span class="badge rounded-circle bg-danger position-absolute" style="top: -5px; right: -5px; width: 1rem; height: 1rem; font-size: 0.75rem; display: flex; align-items: center; justify-content: center;">{{ unread_notification_count }}</span>
                    {% endif %}
                </a>
            {% endif %}
            <a href="{% url 'bookmarks_list' %}" class="quick-access-btn text-white">
                <i class="fas fa-bookmark fs-4"></i>
            </a>
            <a href="#" class="quick-access-btn text-white search-toggle">
                <i class="fas fa-search fs-4"></i>
            </a>
        </div>

        <!-- Other Modals (Email Verification, Resend Verification) -->
        <div class="modal fade" id="emailVerificationModal" tabindex="-1" aria-labelledby="emailVerificationModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-glass">
                    <div class="modal-header">
                        <h5 class="modal-title" id="emailVerificationModalLabel">Verify Your Email</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>A verification email has been sent to your inbox. Please check your email (including spam/junk folder) and click the link to activate your account. Follow us on Twitter <a href="https://twitter.com/corpsconnectt" target="_blank">@corpsconnectt</a> for updates!</p>
                        <p>Didn't receive the email? <a href="{% url 'resend_verification' %}" data-bs-toggle="modal" data-bs-target="#resendVerificationModal" class="btn btn-link">Resend Verification Email</a></p>
                    </div>
                    <div class="modal-footer">
                        <a href="{% url 'login' %}" class="btn btn-custom">Go to Login</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="resendVerificationModal" tabindex="-1" aria-labelledby="resendVerificationModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-glass">
                    <div class="modal-header">
                        <h5 class="modal-title" id="resendVerificationModalLabel">Resend Verification Email</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form method="post" action="{% url 'resend_verification' %}">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="id_email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="id_email" name="email" required>
                            </div>
                            <button type="submit" class="btn btn-custom">Resend</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <main class="content">
            {% block content %}
            {% endblock %}
        </main>
    </div>

    <!-- Load base JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="{% static 'nysc/js/base.js' %}"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('{% static "nysc/js/service-worker.js" %}')
                .then(() => console.log('Service Worker registered'))
                .catch((error) => console.error('Service Worker registration failed:', error));
        }
    </script>
    <!-- Block for child template scripts -->
    {% block extra_scripts %}
    {% endblock %}
</body>
</html>