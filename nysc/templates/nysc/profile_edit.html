{% extends 'nysc/base.html' %}
{% block title %}Edit Profile - Corps Connect{% endblock %}
{% block content %}
{% load static %}
{% load form_tags %}

<section class="py-5" aria-label="Edit Profile Section" style="background: var(--body-bg); min-height: calc(100vh - 70px);">
    <div class="profile-edit-container">
        <div class="profile-header text-center mb-5">
            <div class="profile-image mb-3">
                {% if request.user.profile.profile_picture %}
                    <img src="{{ request.user.profile.profile_picture.url }}" alt="Profile Picture" class="rounded-circle" loading="lazy">
                {% else %}
                    <div class="default-avatar">{{ request.user.username|first|upper }}</div>
                {% endif %}
            </div>
            <h1 class="h2 text-white mb-0">Edit Profile</h1>
        </div>
        {% if messages %}
            <div class="mb-4">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show text-center mx-auto" style="max-width: 600px;" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        <form method="post" enctype="multipart/form-data" class="needs-validation profile-edit-form" novalidate>
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group mb-4 col-md-6">
                    <label for="{{ user_form.username.id_for_label }}" class="form-label text-white">Username</label>
                    {{ user_form.username|add_attrs:"class:form-control bg-transparent text-white border-white" }}
                    <div class="form-text text-light">Enter your desired username.</div>
                    {% if user_form.username.errors %}
                        <div class="invalid-feedback d-block">{{ user_form.username.errors|striptags }}</div>
                    {% endif %}
                </div>
                <div class="form-group mb-4 col-md-6">
                    <label for="{{ profile_form.profile_picture.id_for_label }}" class="form-label text-white">Profile Picture</label>
                    {{ profile_form.profile_picture|add_attrs:"class:form-control bg-transparent text-white border-white" }}
                    <div class="form-text text-light">Upload a clear image (JPEG/PNG, max 2MB).</div>
                    {% if profile_form.profile_picture.errors %}
                        <div class="invalid-feedback d-block">{{ profile_form.profile_picture.errors|striptags }}</div>
                    {% endif %}
                </div>
            </div>
            <div class="form-row">
                <div class="form-group mb-4 col-12">
                    <label for="{{ profile_form.bio.id_for_label }}" class="form-label text-white">Bio</label>
                    {{ profile_form.bio|add_attrs:"class:form-control bg-transparent text-white border-white" }}
                    {% if profile_form.bio.errors %}
                        <div class="invalid-feedback d-block">{{ profile_form.bio.errors|striptags }}</div>
                    {% endif %}
                </div>
            </div>
            <div class="form-row">
                <div class="form-group mb-4 col-md-6">
                    <label for="{{ profile_form.twitter_url.id_for_label }}" class="form-label text-white">Twitter/X URL</label>
                    {{ profile_form.twitter_url|add_attrs:"class:form-control bg-transparent text-white border-white" }}
                    <div class="form-text text-light">Enter your Twitter or X profile URL (e.g., https://twitter.com/username).</div>
                    {% if profile_form.twitter_url.errors %}
                        <div class="invalid-feedback d-block">{{ profile_form.twitter_url.errors|striptags }}</div>
                    {% endif %}
                </div>
                <div class="form-group mb-4 col-md-6">
                    <label for="{{ profile_form.facebook_url.id_for_label }}" class="form-label text-white">Facebook URL</label>
                    {{ profile_form.facebook_url|add_attrs:"class:form-control bg-transparent text-white border-white" }}
                    <div class="form-text text-light">Enter your Facebook profile URL (e.g., https://facebook.com/username).</div>
                    {% if profile_form.facebook_url.errors %}
                        <div class="invalid-feedback d-block">{{ profile_form.facebook_url.errors|striptags }}</div>
                    {% endif %}
                </div>
            </div>
            <div class="form-row">
                <div class="form-group mb-4 col-12">
                    <div class="profile-edit-checklist">
                        {{ profile_form.is_public }}
                        <label class="profile-edit-checklist-label text-white" for="{{ profile_form.is_public.id_for_label }}">
                            <i class="profile-edit-icon fas fa-trophy"></i> Appear on Leaderboard
                        </label>
                        
                        {% if profile_form.is_public.errors %}
                            <div class="invalid-feedback d-block">{{ profile_form.is_public.errors|striptags }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group mb-4 col-12">
                    <h4 class="h5 text-white mb-3">Notification Preferences</h4>
                    <div class="profile-edit-checklist mb-2">
                        {{ profile_form.notify_follow }}
                        <label class="profile-edit-checklist-label text-white" for="{{ profile_form.notify_follow.id_for_label }}">
                            <i class="profile-edit-icon fas fa-users"></i> Notify when someone follows me
                        </label>
                        {% if profile_form.notify_follow.errors %}
                            <div class="invalid-feedback d-block">{{ profile_form.notify_follow.errors|striptags }}</div>
                        {% endif %}
                    </div>
                    <div class="profile-edit-checklist mb-2">
                        {{ profile_form.notify_rating }}
                        <label class="profile-edit-checklist-label text-white" for="{{ profile_form.notify_rating.id_for_label }}">
                            <i class="profile-edit-icon fas fa-heart"></i> Notify when a post is rated
                        </label>
                        {% if profile_form.notify_rating.errors %}
                            <div class="invalid-feedback d-block">{{ profile_form.notify_rating.errors|striptags }}</div>
                        {% endif %}
                    </div>
                    <div class="profile-edit-checklist mb-2">
                        {{ profile_form.notify_leaderboard }}
                        <label class="profile-edit-checklist-label text-white" for="{{ profile_form.notify_leaderboard.id_for_label }}">
                            <i class="profile-edit-icon fas fa-award"></i> Notify when I appear on the leaderboard
                        </label>
                        {% if profile_form.notify_leaderboard.errors %}
                            <div class="invalid-feedback d-block">{{ profile_form.notify_leaderboard.errors|striptags }}</div>
                        {% endif %}
                    </div>
                    <div class="profile-edit-checklist mb-3">
                        {{ profile_form.notify_post }}
                        <label class="profile-edit-checklist-label text-white" for="{{ profile_form.notify_post.id_for_label }}">
                            <i class="profile-edit-icon fas fa-bell"></i> Notify when someone I follow posts
                        </label>
                        {% if profile_form.notify_post.errors %}
                            <div class="invalid-feedback d-block">{{ profile_form.notify_post.errors|striptags }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="text-center mt-5">
                <button type="submit" class="btn btn-primary btn-lg px-5 py-3" aria-label="Save Changes">
                    Save Changes
                </button>
            </div>
        </form>
    </div>
</section>
{% endblock %}

